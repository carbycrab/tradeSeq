<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Evaluate the optimal number of knots required for fitGAM. — evaluateK • tradeSeq</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Evaluate the optimal number of knots required for fitGAM. — evaluateK" />
<meta property="og:description" content="Evaluate the optimal number of knots required for fitGAM.
Evaluate an appropriate number of knots." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tradeSeq</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.5.07</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/tradeSeq.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Monocle.html">Using Monocle as input to **tradeSeq**</a>
    </li>
    <li>
      <a href="../articles/fitGAM.html">Fitting the models and additional control of fitGAM in **tradeSeq**</a>
    </li>
    <li>
      <a href="../articles/multipleConditions.html">Working with multiple conditions</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/statOmics/tradeSeq/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Evaluate the optimal number of knots required for fitGAM.</h1>
    <small class="dont-index">Source: <a href='https://github.com/statOmics/tradeSeq/blob/master/R/AllGenerics.R'><code>R/AllGenerics.R</code></a>, <a href='https://github.com/statOmics/tradeSeq/blob/master/R/evaluateK.R'><code>R/evaluateK.R</code></a></small>
    <div class="hidden name"><code>evaluateK.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Evaluate the optimal number of knots required for fitGAM.</p>
<p>Evaluate an appropriate number of knots.</p>
    </div>

    <pre class="usage"><span class='fu'>evaluateK</span><span class='op'>(</span><span class='va'>counts</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S4 method for matrix</span>
<span class='fu'>evaluateK</span><span class='op'>(</span>
  <span class='va'>counts</span>,
  k <span class='op'>=</span> <span class='fl'>3</span><span class='op'>:</span><span class='fl'>10</span>,
  nGenes <span class='op'>=</span> <span class='fl'>500</span>,
  sds <span class='op'>=</span> <span class='cn'>NULL</span>,
  pseudotime <span class='op'>=</span> <span class='cn'>NULL</span>,
  cellWeights <span class='op'>=</span> <span class='cn'>NULL</span>,
  U <span class='op'>=</span> <span class='cn'>NULL</span>,
  conditions <span class='op'>=</span> <span class='cn'>NULL</span>,
  plot <span class='op'>=</span> <span class='cn'>TRUE</span>,
  weights <span class='op'>=</span> <span class='cn'>NULL</span>,
  offset <span class='op'>=</span> <span class='cn'>NULL</span>,
  aicDiff <span class='op'>=</span> <span class='fl'>2</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span>,
  parallel <span class='op'>=</span> <span class='cn'>FALSE</span>,
  BPPARAM <span class='op'>=</span> <span class='fu'>BiocParallel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/BiocParallel/man/register.html'>bpparam</a></span><span class='op'>(</span><span class='op'>)</span>,
  control <span class='op'>=</span> <span class='fu'>mgcv</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/mgcv/man/gam.control.html'>gam.control</a></span><span class='op'>(</span><span class='op'>)</span>,
  family <span class='op'>=</span> <span class='st'>"nb"</span>,
  gcv <span class='op'>=</span> <span class='cn'>FALSE</span>,
  <span class='va'>...</span>
<span class='op'>)</span>

<span class='co'># S4 method for dgCMatrix</span>
<span class='fu'>evaluateK</span><span class='op'>(</span>
  <span class='va'>counts</span>,
  k <span class='op'>=</span> <span class='fl'>3</span><span class='op'>:</span><span class='fl'>10</span>,
  nGenes <span class='op'>=</span> <span class='fl'>500</span>,
  sds <span class='op'>=</span> <span class='cn'>NULL</span>,
  pseudotime <span class='op'>=</span> <span class='cn'>NULL</span>,
  cellWeights <span class='op'>=</span> <span class='cn'>NULL</span>,
  plot <span class='op'>=</span> <span class='cn'>TRUE</span>,
  U <span class='op'>=</span> <span class='cn'>NULL</span>,
  weights <span class='op'>=</span> <span class='cn'>NULL</span>,
  offset <span class='op'>=</span> <span class='cn'>NULL</span>,
  aicDiff <span class='op'>=</span> <span class='fl'>2</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span>,
  conditions <span class='op'>=</span> <span class='cn'>NULL</span>,
  control <span class='op'>=</span> <span class='fu'>mgcv</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/mgcv/man/gam.control.html'>gam.control</a></span><span class='op'>(</span><span class='op'>)</span>,
  parallel <span class='op'>=</span> <span class='cn'>FALSE</span>,
  BPPARAM <span class='op'>=</span> <span class='fu'>BiocParallel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/BiocParallel/man/register.html'>bpparam</a></span><span class='op'>(</span><span class='op'>)</span>,
  family <span class='op'>=</span> <span class='st'>"nb"</span>,
  gcv <span class='op'>=</span> <span class='cn'>FALSE</span>,
  <span class='va'>...</span>
<span class='op'>)</span>

<span class='co'># S4 method for SingleCellExperiment</span>
<span class='fu'>evaluateK</span><span class='op'>(</span>
  <span class='va'>counts</span>,
  k <span class='op'>=</span> <span class='fl'>3</span><span class='op'>:</span><span class='fl'>10</span>,
  nGenes <span class='op'>=</span> <span class='fl'>500</span>,
  sds <span class='op'>=</span> <span class='cn'>NULL</span>,
  pseudotime <span class='op'>=</span> <span class='cn'>NULL</span>,
  cellWeights <span class='op'>=</span> <span class='cn'>NULL</span>,
  plot <span class='op'>=</span> <span class='cn'>TRUE</span>,
  U <span class='op'>=</span> <span class='cn'>NULL</span>,
  weights <span class='op'>=</span> <span class='cn'>NULL</span>,
  offset <span class='op'>=</span> <span class='cn'>NULL</span>,
  aicDiff <span class='op'>=</span> <span class='fl'>2</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span>,
  conditions <span class='op'>=</span> <span class='cn'>NULL</span>,
  parallel <span class='op'>=</span> <span class='cn'>FALSE</span>,
  BPPARAM <span class='op'>=</span> <span class='fu'>BiocParallel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/BiocParallel/man/register.html'>bpparam</a></span><span class='op'>(</span><span class='op'>)</span>,
  control <span class='op'>=</span> <span class='fu'>mgcv</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/mgcv/man/gam.control.html'>gam.control</a></span><span class='op'>(</span><span class='op'>)</span>,
  family <span class='op'>=</span> <span class='st'>"nb"</span>,
  gcv <span class='op'>=</span> <span class='cn'>FALSE</span>,
  <span class='va'>...</span>
<span class='op'>)</span>

<span class='co'># S4 method for CellDataSet</span>
<span class='fu'>evaluateK</span><span class='op'>(</span>
  <span class='va'>counts</span>,
  k <span class='op'>=</span> <span class='fl'>3</span><span class='op'>:</span><span class='fl'>10</span>,
  nGenes <span class='op'>=</span> <span class='fl'>500</span>,
  sds <span class='op'>=</span> <span class='cn'>NULL</span>,
  pseudotime <span class='op'>=</span> <span class='cn'>NULL</span>,
  cellWeights <span class='op'>=</span> <span class='cn'>NULL</span>,
  plot <span class='op'>=</span> <span class='cn'>TRUE</span>,
  U <span class='op'>=</span> <span class='cn'>NULL</span>,
  weights <span class='op'>=</span> <span class='cn'>NULL</span>,
  offset <span class='op'>=</span> <span class='cn'>NULL</span>,
  aicDiff <span class='op'>=</span> <span class='fl'>2</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span>,
  conditions <span class='op'>=</span> <span class='cn'>NULL</span>,
  parallel <span class='op'>=</span> <span class='cn'>FALSE</span>,
  BPPARAM <span class='op'>=</span> <span class='fu'>BiocParallel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/BiocParallel/man/register.html'>bpparam</a></span><span class='op'>(</span><span class='op'>)</span>,
  control <span class='op'>=</span> <span class='fu'>mgcv</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/mgcv/man/gam.control.html'>gam.control</a></span><span class='op'>(</span><span class='op'>)</span>,
  family <span class='op'>=</span> <span class='st'>"nb"</span>,
  gcv <span class='op'>=</span> <span class='cn'>FALSE</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>counts</th>
      <td><p>The count matrix, genes in rows and cells in columns.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>parameters including:</p></td>
    </tr>
    <tr>
      <th>k</th>
      <td><p>The range of knots to evaluate. `3:10` by default. See details.</p></td>
    </tr>
    <tr>
      <th>nGenes</th>
      <td><p>The number of genes to use in the evaluation. Genes will be
randomly selected. 500 by default.</p></td>
    </tr>
    <tr>
      <th>sds</th>
      <td><p>Slingshot object containing the lineages.</p></td>
    </tr>
    <tr>
      <th>pseudotime</th>
      <td><p>a matrix of pseudotime values, each row represents a cell
and each column represents a lineage.</p></td>
    </tr>
    <tr>
      <th>cellWeights</th>
      <td><p>a matrix of cell weights defining the probability that a
cell belongs to a particular lineage. Each row represents a cell and each
column represents a lineage.</p></td>
    </tr>
    <tr>
      <th>U</th>
      <td><p>The design matrix of fixed effects. The design matrix should not
contain an intercept to ensure identifiability.</p></td>
    </tr>
    <tr>
      <th>conditions</th>
      <td><p>This argument is in beta phase and should be used carefully.
If each lineage consists of multiple conditions, this argument can be used to
specify the conditions. tradeSeq will then fit a condition-specific smoother for
every lineage.</p></td>
    </tr>
    <tr>
      <th>plot</th>
      <td><p>Whether to display diagnostic plots. Default to <code>TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>weights</th>
      <td><p>Optional: a matrix of weights with identical dimensions
as the <code>counts</code> matrix. Usually a matrix of zero-inflation weights.</p></td>
    </tr>
    <tr>
      <th>offset</th>
      <td><p>Optional: the offset, on log-scale. If NULL, TMM is used to
account for differences in sequencing depth, see <code>fitGAM</code>.</p></td>
    </tr>
    <tr>
      <th>aicDiff</th>
      <td><p>Used for selecting genes with significantly varying AIC values
over the range of evaluated knots to make the barplot output. Default is set
to 2, meaning that only genes whose AIC range is larger than 2 will be used
to check for the optimal number of knots through the barplot visualization
that is part of the output of this function.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>logical, should progress be verbose?</p></td>
    </tr>
    <tr>
      <th>parallel</th>
      <td><p>Logical, defaults to FALSE. Set to TRUE if you want to
parallellize the fitting.</p></td>
    </tr>
    <tr>
      <th>BPPARAM</th>
      <td><p>object of class <code>bpparamClass</code> that specifies the
back-end to be used for computations. See
<code>bpparam</code> in <code>BiocParallel</code> package for details.</p></td>
    </tr>
    <tr>
      <th>control</th>
      <td><p>Control object for GAM fitting, see <code><a href='https://rdrr.io/pkg/mgcv/man/gam.control.html'>mgcv::gam.control()</a></code>.</p></td>
    </tr>
    <tr>
      <th>family</th>
      <td><p>The distribution assumed, currently only <code>"nb"</code>
(negative binomial) is supported.</p></td>
    </tr>
    <tr>
      <th>gcv</th>
      <td><p>(In development). Logical, should a GCV score also be returned?</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A plot of average AIC value over the range of selected knots, and a
matrix of AIC and GCV values for the selected genes (rows) and the
range of knots (columns).</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The number of parameter to evaluate (and therefore the runtime) scales in 
<code>k</code> * the number of lineages. Morevoer, we have found that, in practice,
values of k above 12-15 rarely lead to improved result, not matter the 
complexity of the trajectory being considered. As such, we recommand that user
proceed with care when setting k to value higher than 15.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>## This is an artificial example, please check the vignette for a realistic one.</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>8</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>sds</span>, package<span class='op'>=</span><span class='st'>"tradeSeq"</span><span class='op'>)</span>
<span class='va'>loadings</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='fl'>2000</span><span class='op'>*</span><span class='fl'>2</span>, <span class='op'>-</span><span class='fl'>2</span>, <span class='fl'>2</span><span class='op'>)</span>, nrow <span class='op'>=</span> <span class='fl'>2</span>, ncol <span class='op'>=</span> <span class='fl'>2000</span><span class='op'>)</span>
<span class='va'>counts</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='fu'>slingshot</span><span class='fu'>::</span><span class='fu'>reducedDim</span><span class='op'>(</span><span class='va'>sds</span><span class='op'>)</span> <span class='op'>%*%</span> <span class='va'>loadings</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> <span class='fl'>100</span>
<span class='va'>aicK</span> <span class='op'>&lt;-</span> <span class='fu'>evaluateK</span><span class='op'>(</span>counts <span class='op'>=</span> <span class='va'>counts</span>, sds <span class='op'>=</span> <span class='va'>sds</span>, nGenes <span class='op'>=</span> <span class='fl'>100</span>,
                  k <span class='op'>=</span> <span class='fl'>3</span><span class='op'>:</span><span class='fl'>5</span>, verbose <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</div><div class='img'><img src='evaluateK-1.png' alt='' width='700' height='433' /></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Koen Van den Berge, Hector Roux de Bezieux, Lieven Clement.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


